{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "languageVersion": "2.0",
  "contentVersion": "1.0.0.0",
  "definitions": {
    "resolveItemType": {
      "type": "object",
      "properties": {
        "object": {
          "type": "object",
          "nullable": true
        },
        "key": {
          "type": "string"
        }
      }
    },
    "placeholderInfoType": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "optional": {
          "type": "bool"
        },
        "type": {
          "type": "string",
          "nullable": true
        }
      },
      "nullable": true
    },
    "formatNameInfoType": {
      "type": "object",
      "properties": {
        "formatString": {
          "$ref": "#/definitions/formatStringType"
        },
        "separator": {
          "type": "string",
          "nullable": true
        },
        "placeholders": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/placeholderInfoType"
          }
        },
        "values": {
          "type": "object"
        },
        "valueKeys": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "validValueKeys": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "casing": {
          "type": "string",
          "nullable": true
        },
        "maxLength": {
          "type": "int",
          "nullable": true
        },
        "additionalValues": {
          "type": "bool"
        }
      }
    },
    "formatNameResultType": {
      "type": "object",
      "properties": {
        "formatInfo": {
          "$ref": "#/definitions/formatNameInfoType"
        },
        "result": {
          "type": "string"
        },
        "isValid": {
          "type": "bool"
        }
      }
    },
    "placeholderLookupItemType": {
      "type": "object",
      "properties": {
        "value": {
          "type": "string"
        },
        "name": {
          "type": "string"
        }
      }
    },
    "instanceInfoType": {
      "type": "object",
      "properties": {
        "value": {
          "type": "int",
          "nullable": true
        },
        "minValue": {
          "type": "int",
          "nullable": true
        },
        "maxValue": {
          "type": "int"
        },
        "padding": {
          "type": "object",
          "properties": {
            "totalLength": {
              "type": "int"
            },
            "character": {
              "type": "string"
            }
          }
        }
      }
    },
    "uniqueInfoType": {
      "type": "object",
      "properties": {
        "length": {
          "type": "int",
          "nullable": true
        },
        "seed": {
          "type": "string",
          "nullable": true
        }
      }
    },
    "formatStringType": {
      "type": "object",
      "properties": {
        "lookup": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      }
    },
    "nameFunctionOptionType": {
      "type": "string",
      "allowedValues": [
        "evaluateName",
        "formatName"
      ]
    }
  },
  "functions": [
    {
      "namespace": "namingConvention",
      "members": {
        "formatName": {
          "parameters": [
            {
              "type": "string",
              "name": "formatString"
            },
            {
              "type": "object",
              "name": "values"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "additionalValues"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "string",
            "value": "[namingConvention.evaluateName(parameters('formatString'), parameters('values'), parameters('additionalValues'), true(), parameters('config')).result]"
          }
        },
        "evaluateName": {
          "parameters": [
            {
              "type": "string",
              "name": "formatString"
            },
            {
              "type": "object",
              "name": "values"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "additionalValues"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "throwError"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "$ref": "#/definitions/formatNameResultType",
            "value": "[map(map(map(createArray(createObject('formatInfo', namingConvention.getFormatInfo(createObject('lookup', parameters('formatString'), 'value', namingConvention.getFormatString(parameters('formatString'), parameters('config'))), parameters('values'), parameters('additionalValues'), coalesce(parameters('throwError'), false()), parameters('config')), 'result', null(), 'isValid', false())), lambda('item', createObject('formatInfo', lambdaVariables('item').formatInfo, 'result', lambdaVariables('item').result, 'isValid', namingConvention.validate(lambdaVariables('item').formatInfo, lambdaVariables('item').result, coalesce(parameters('throwError'), false()))))), lambda('item', createObject('formatInfo', lambdaVariables('item').formatInfo, 'result', if(or(lambdaVariables('item').isValid, not(coalesce(parameters('throwError'), false()))), trim(namingConvention.replacePlaceholders(lambdaVariables('item').formatInfo)), ''), 'isValid', lambdaVariables('item').isValid))), lambda('item', createObject('formatInfo', lambdaVariables('item').formatInfo, 'result', if(lambdaVariables('item').isValid, namingConvention.applyCasing(lambdaVariables('item').result, lambdaVariables('item').formatInfo.casing), lambdaVariables('item').result), 'isValid', if(lambdaVariables('item').isValid, namingConvention.validate(lambdaVariables('item').formatInfo, lambdaVariables('item').result, coalesce(parameters('throwError'), false())), false()))))[0]]"
          }
        },
        "nameGraph": {
          "parameters": [
            {
              "type": "string",
              "nullable": true,
              "name": "formatString"
            },
            {
              "type": "object",
              "nullable": true,
              "name": "values"
            },
            {
              "type": "object",
              "name": "graph"
            },
            {
              "$ref": "#/definitions/nameFunctionOptionType",
              "name": "function"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "additionalValues"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "object",
            "value": "[map(createArray(namingConvention.applyOnGraph0(parameters('graph'), parameters('function'), createObject('formatString', if(equals(parameters('formatString'), ''), null(), parameters('formatString')), 'values', coalesce(parameters('values'), createObject()), 'additionalValues', parameters('additionalValues'), 'config', namingConvention.resolveConfig(parameters('config'))))), lambda('item', if(equals(parameters('function'), 'evaluateName'), createObject('items', namingConvention.flattenObject(lambdaVariables('item'))), lambdaVariables('item'))))[0]]"
          }
        },
        "applyOnGraph0": {
          "parameters": [
            {
              "type": "object",
              "name": "object"
            },
            {
              "$ref": "#/definitions/nameFunctionOptionType",
              "name": "function"
            },
            {
              "type": "object",
              "nullable": true,
              "name": "params"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', if(namingConvention.isObjectItem(lambdaVariables('item')), if(namingConvention.isNameObject(lambdaVariables('item').value), namingConvention.invokeNameFunction(parameters('function'), namingConvention.getNameFunctionParameters(lambdaVariables('item').value, parameters('params'))).result, namingConvention.applyOnGraph1(lambdaVariables('item'), parameters('function'), parameters('params'))), lambdaVariables('item').value)))), createObject(), lambda('current', 'next', union(lambdaVariables('current'), createObject(format('{0}', lambdaVariables('next').key), lambdaVariables('next').value))))]"
          }
        },
        "applyOnGraph1": {
          "parameters": [
            {
              "type": "object",
              "name": "keyValue"
            },
            {
              "$ref": "#/definitions/nameFunctionOptionType",
              "name": "function"
            },
            {
              "type": "object",
              "nullable": true,
              "name": "params"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(parameters('keyValue').value), lambda('item', createObject('key', lambdaVariables('item').key, 'value', if(namingConvention.isObjectItem(lambdaVariables('item')), if(namingConvention.isNameObject(lambdaVariables('item').value), namingConvention.invokeNameFunction(parameters('function'), namingConvention.getNameFunctionParameters(lambdaVariables('item').value, parameters('params'))).result, namingConvention.applyOnGraph2(lambdaVariables('item'), parameters('function'), parameters('params'))), lambdaVariables('item').value)))), createObject(), lambda('current', 'next', union(lambdaVariables('current'), createObject(format('{0}', lambdaVariables('next').key), lambdaVariables('next').value))))]"
          }
        },
        "applyOnGraph2": {
          "parameters": [
            {
              "type": "object",
              "name": "keyValue"
            },
            {
              "$ref": "#/definitions/nameFunctionOptionType",
              "name": "function"
            },
            {
              "type": "object",
              "nullable": true,
              "name": "params"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(parameters('keyValue').value), lambda('item', createObject('key', lambdaVariables('item').key, 'value', if(namingConvention.isObjectItem(lambdaVariables('item')), if(namingConvention.isNameObject(lambdaVariables('item').value), namingConvention.invokeNameFunction(parameters('function'), namingConvention.getNameFunctionParameters(lambdaVariables('item').value, parameters('params'))).result, namingConvention.applyOnGraph3(lambdaVariables('item'), parameters('function'), parameters('params'))), lambdaVariables('item').value)))), createObject(), lambda('current', 'next', union(lambdaVariables('current'), createObject(format('{0}', lambdaVariables('next').key), lambdaVariables('next').value))))]"
          }
        },
        "applyOnGraph3": {
          "parameters": [
            {
              "type": "object",
              "name": "keyValue"
            },
            {
              "$ref": "#/definitions/nameFunctionOptionType",
              "name": "function"
            },
            {
              "type": "object",
              "nullable": true,
              "name": "params"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(parameters('keyValue').value), lambda('item', createObject('key', lambdaVariables('item').key, 'value', if(namingConvention.isObjectItem(lambdaVariables('item')), if(namingConvention.isNameObject(lambdaVariables('item').value), namingConvention.invokeNameFunction(parameters('function'), namingConvention.getNameFunctionParameters(lambdaVariables('item').value, parameters('params'))).result, lambdaVariables('item').value), lambdaVariables('item').value)))), createObject(), lambda('current', 'next', union(lambdaVariables('current'), createObject(format('{0}', lambdaVariables('next').key), lambdaVariables('next').value))))]"
          }
        },
        "invokeNameFunction": {
          "parameters": [
            {
              "$ref": "#/definitions/nameFunctionOptionType",
              "name": "function"
            },
            {
              "type": "object",
              "name": "params"
            }
          ],
          "output": {
            "type": "object",
            "value": {
              "result": "[if(equals(parameters('function'), 'formatName'), namingConvention.formatName(parameters('params').formatString, parameters('params').values, parameters('params').additionalValues, parameters('params').config), namingConvention.evaluateName(parameters('params').formatString, parameters('params').values, parameters('params').additionalValues, null(), parameters('params').config))]"
            }
          }
        },
        "getNameFunctionParameters": {
          "parameters": [
            {
              "type": "object",
              "name": "value"
            },
            {
              "type": "object",
              "nullable": true,
              "name": "params"
            }
          ],
          "output": {
            "type": "object",
            "value": "[union(coalesce(parameters('params'), createObject()), createObject('formatString', coalesce(coalesce(tryGet(parameters('value'), 'formatString'), tryGet(parameters('params'), 'formatString')), 'default'), 'values', union(coalesce(tryGet(parameters('params'), 'values'), createObject()), coalesce(tryGet(parameters('value'), 'values'), createObject()))))]"
          }
        },
        "isNameObject": {
          "parameters": [
            {
              "type": "object",
              "nullable": true,
              "name": "object"
            }
          ],
          "output": {
            "type": "bool",
            "value": "[or(or(not(equals(tryGet(parameters('object'), 'formatString'), null())), not(equals(tryGet(parameters('object'), 'resourceType'), null()))), not(equals(tryGet(parameters('object'), 'values'), null())))]"
          }
        },
        "isObjectItem": {
          "parameters": [
            {
              "type": "object",
              "name": "keyValue"
            }
          ],
          "output": {
            "type": "bool",
            "value": "[map(createArray(createObject('key', parameters('keyValue').key, 'value', parameters('keyValue').value, 'stringValue', string(coalesce(parameters('keyValue').value, '')))), lambda('item', and(startsWith(lambdaVariables('item').stringValue, '{'), endsWith(lambdaVariables('item').stringValue, '}'))))[0]]"
          }
        },
        "getFormatInfo": {
          "parameters": [
            {
              "$ref": "#/definitions/formatStringType",
              "name": "formatString"
            },
            {
              "type": "object",
              "name": "values"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "additionalValues"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "throwError"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "$ref": "#/definitions/formatNameInfoType",
            "value": "[map(createArray(map(createArray(createObject('formatString', parameters('formatString'), 'separator', namingConvention.getSeparatorString(coalesce(coalesce(namingConvention.getResourceTypeLookup(parameters('formatString').lookup, parameters('config')), namingConvention.getResourceTypeLookup(coalesce(tryGet(parameters('values'), 'RESOURCE_TYPE'), tryGet(parameters('values'), 'RESOURCE')), parameters('config'))), ''), parameters('config')), 'placeholders', namingConvention.getPlaceholderInfo(parameters('formatString').value, parameters('config')), 'values', parameters('values'), 'valueKeys', objectKeys(parameters('values')), 'validValueKeys', createArray(), 'casing', namingConvention.getCasing(parameters('formatString').lookup, parameters('config')), 'maxLength', namingConvention.getMaxLength(parameters('formatString').lookup, parameters('config')), 'additionalValues', coalesce(parameters('additionalValues'), true()))), lambda('item', createObject('formatString', lambdaVariables('item').formatString, 'separator', lambdaVariables('item').separator, 'placeholders', lambdaVariables('item').placeholders, 'values', namingConvention.initializeValues(lambdaVariables('item'), parameters('throwError'), parameters('config')), 'valueKeys', lambdaVariables('item').valueKeys, 'validValueKeys', lambdaVariables('item').validValueKeys, 'casing', lambdaVariables('item').casing, 'maxLength', lambdaVariables('item').maxLength, 'additionalValues', lambdaVariables('item').additionalValues)))[0]), lambda('item', createObject('formatString', lambdaVariables('item').formatString, 'separator', lambdaVariables('item').separator, 'placeholders', lambdaVariables('item').placeholders, 'values', lambdaVariables('item').values, 'valueKeys', lambdaVariables('item').valueKeys, 'validValueKeys', namingConvention.getValidValueKeys(lambdaVariables('item').placeholders, lambdaVariables('item').values), 'casing', lambdaVariables('item').casing, 'maxLength', lambdaVariables('item').maxLength, 'additionalValues', lambdaVariables('item').additionalValues)))[0]]"
          }
        },
        "replacePlaceholders": {
          "parameters": [
            {
              "$ref": "#/definitions/formatNameInfoType",
              "name": "formatInfo"
            }
          ],
          "output": {
            "type": "string",
            "value": "[join(map(map(split(parameters('formatInfo').formatString.value, '['), lambda('item0', reduce(map(items(parameters('formatInfo').values), lambda('item1', createObject('key', lambdaVariables('item1').key, 'value', lambdaVariables('item1').value, 'result', lambdaVariables('item0')))), createObject('result', lambdaVariables('item0')), lambda('current', 'next', createObject('result', if(and(contains(parameters('formatInfo').validValueKeys, lambdaVariables('next').key), not(equals(lambdaVariables('next').value, null()))), replace(lambdaVariables('current').result, format('{{{0}}}', lambdaVariables('next').key), string(coalesce(lambdaVariables('next').value, ''))), lambdaVariables('current').result)))).result)), lambda('item', if(contains(lambdaVariables('item'), ']'), join(map(split(lambdaVariables('item'), ']'), lambda('item1', 'index1', if(greater(lambdaVariables('index1'), 0), lambdaVariables('item1'), if(and(contains(lambdaVariables('item1'), '{'), contains(lambdaVariables('item1'), '}')), '', lambdaVariables('item1'))))), ''), lambdaVariables('item')))), '')]"
          }
        },
        "initializeValues": {
          "parameters": [
            {
              "$ref": "#/definitions/formatNameInfoType",
              "name": "formatInfo"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "throwError"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(union(if(not(equals(coalesce(namingConvention.getResourceTypeLookup(parameters('formatInfo').formatString.lookup, parameters('config')), namingConvention.getResourceTypeLookup(coalesce(tryGet(parameters('formatInfo').values, 'RESOURCE_TYPE'), tryGet(parameters('formatInfo').values, 'RESOURCE')), parameters('config'))), null())), createObject('RESOURCE', coalesce(namingConvention.getResourceTypeLookup(parameters('formatInfo').formatString.lookup, parameters('config')), namingConvention.getResourceTypeLookup(coalesce(tryGet(parameters('formatInfo').values, 'RESOURCE_TYPE'), tryGet(parameters('formatInfo').values, 'RESOURCE')), parameters('config'))), 'RESOURCE_TYPE', coalesce(namingConvention.getResourceTypeLookup(parameters('formatInfo').formatString.lookup, parameters('config')), namingConvention.getResourceTypeLookup(coalesce(tryGet(parameters('formatInfo').values, 'RESOURCE_TYPE'), tryGet(parameters('formatInfo').values, 'RESOURCE')), parameters('config')))), createObject()), parameters('formatInfo').values, if(and(equals(tryGet(parameters('formatInfo').values, '-'), null()), equals(tryGet(parameters('formatInfo').values, 'SEPARATOR'), null())), createObject('-', parameters('formatInfo').separator, 'SEPARATOR', parameters('formatInfo').separator), createObject()))), lambda('item0', createObject(format('{0}', lambdaVariables('item0').key), if(greater(length(filter(parameters('formatInfo').placeholders, lambda('item1', equals(tryGet(lambdaVariables('item1'), 'name'), lambdaVariables('item0').key)))), 0), if(and(not(equals(lambdaVariables('item0').value, null())), equals(namingConvention.getPlaceholderType(lambdaVariables('item0').key, parameters('config')), 'instance')), namingConvention.getInstanceString(namingConvention.resolveInstanceValue(lambdaVariables('item0').value, lambdaVariables('item0').key, parameters('config'))), if(equals(namingConvention.getPlaceholderType(lambdaVariables('item0').key, parameters('config')), 'lookup'), tryGet(namingConvention.resolvePlaceholderLookupValue(lambdaVariables('item0').key, string(coalesce(lambdaVariables('item0').value, '')), parameters('throwError'), parameters('config')), 'value'), if(equals(namingConvention.getPlaceholderType(lambdaVariables('item0').key, parameters('config')), 'unique'), namingConvention.getUniqueString(namingConvention.resolveUniqueValue(lambdaVariables('item0').value, parameters('formatInfo').values, parameters('formatInfo').placeholders, null(), parameters('config'))), lambdaVariables('item0').value))), null())))), createObject(), lambda('current', 'next', union(lambdaVariables('current'), lambdaVariables('next'))))]"
          }
        },
        "getResourceTypeLookup": {
          "parameters": [
            {
              "type": "string",
              "nullable": true,
              "name": "value"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "string",
            "nullable": true,
            "value": "[if(contains(coalesce(tryGet(tryGet(tryGet(parameters('config'), 'placeholders'), 'RESOURCE_TYPE'), 'source'), createObject()), replace(coalesce(parameters('value'), ''), ' ', '')), replace(coalesce(parameters('value'), ''), ' ', ''), null())]"
          }
        },
        "getPlaceholderType": {
          "parameters": [
            {
              "type": "string",
              "name": "name"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "string",
            "nullable": true,
            "value": "[tryGet(tryGet(tryGet(parameters('config'), 'placeholders'), parameters('name')), '$type')]"
          }
        },
        "resolvePlaceholderLookupValue": {
          "parameters": [
            {
              "type": "string",
              "name": "configKey"
            },
            {
              "type": "string",
              "name": "valueKey"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "throwError"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "$ref": "#/definitions/placeholderLookupItemType",
            "nullable": true,
            "value": "[map(createArray(if(equals(tryGet(parameters('config').placeholders[parameters('configKey')].source, replace(coalesce(parameters('valueKey'), ''), ' ', '')), null()), if(and(equals(replace(coalesce(parameters('valueKey'), ''), ' ', ''), ''), not(equals(tryGet(parameters('config').placeholders[parameters('configKey')], 'default'), null()))), parameters('config').placeholders[parameters('configKey')].source[replace(coalesce(parameters('config').placeholders[parameters('configKey')].default, ''), ' ', '')], if(coalesce(parameters('throwError'), true()), parameters('config').placeholders[parameters('configKey')].source[replace(coalesce(parameters('valueKey'), ''), ' ', '')], null())), parameters('config').placeholders[parameters('configKey')].source[replace(coalesce(parameters('valueKey'), ''), ' ', '')])), lambda('item', createObject('value', coalesce(tryGet(lambdaVariables('item'), 'value'), ''), 'name', replace(coalesce(parameters('valueKey'), ''), ' ', ''))))[0]]"
          }
        },
        "resolveInstanceValue": {
          "parameters": [
            {
              "type": "int",
              "nullable": true,
              "name": "value"
            },
            {
              "type": "string",
              "nullable": true,
              "name": "configKey"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "$ref": "#/definitions/instanceInfoType",
            "value": {
              "value": "[parameters('value')]",
              "minValue": "[namingConvention.resolveAny(createArray(createObject('key', 'minValue', 'object', tryGet(tryGet(parameters('config'), 'placeholders'), coalesce(parameters('configKey'), ''))), createObject('key', 'minValue', 'object', tryGet(tryGet(parameters('config'), 'placeholders'), 'INSTANCE')))).result]",
              "maxValue": "[namingConvention.resolveAny(createArray(createObject('key', 'maxValue', 'object', tryGet(tryGet(parameters('config'), 'placeholders'), coalesce(parameters('configKey'), ''))), createObject('key', 'maxValue', 'object', tryGet(tryGet(parameters('config'), 'placeholders'), 'INSTANCE')))).result]",
              "padding": {
                "totalLength": "[namingConvention.resolveAny(createArray(createObject('key', 'totalLength', 'object', tryGet(tryGet(tryGet(parameters('config'), 'placeholders'), coalesce(parameters('configKey'), '')), 'padding')), createObject('key', 'totalLength', 'object', tryGet(tryGet(tryGet(parameters('config'), 'placeholders'), 'INSTANCE'), 'padding')))).result]",
                "character": "[namingConvention.resolveAny(createArray(createObject('key', 'character', 'object', tryGet(tryGet(tryGet(parameters('config'), 'placeholders'), coalesce(parameters('configKey'), '')), 'padding')), createObject('key', 'character', 'object', tryGet(tryGet(tryGet(parameters('config'), 'placeholders'), 'INSTANCE'), 'padding')))).result]"
              }
            }
          }
        },
        "resolveUniqueValue": {
          "parameters": [
            {
              "type": "object",
              "nullable": true,
              "name": "value"
            },
            {
              "type": "object",
              "name": "values"
            },
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/placeholderInfoType"
              },
              "name": "placeholders"
            },
            {
              "type": "string",
              "nullable": true,
              "name": "configKey"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "$ref": "#/definitions/uniqueInfoType",
            "value": {
              "length": "[namingConvention.resolveAny(createArray(createObject('key', 'length', 'object', parameters('value')), createObject('key', 'length', 'object', tryGet(tryGet(parameters('config'), 'placeholders'), coalesce(parameters('configKey'), ''))), createObject('key', 'length', 'object', tryGet(tryGet(parameters('config'), 'placeholders'), 'UNIQUE')))).result]",
              "seed": "[coalesce(namingConvention.resolveAny(createArray(createObject('key', 'seed', 'object', parameters('value')), createObject('key', 'seed', 'object', tryGet(tryGet(parameters('config'), 'placeholders'), coalesce(parameters('configKey'), ''))), createObject('key', 'seed', 'object', tryGet(tryGet(parameters('config'), 'placeholders'), 'UNIQUE')))).result, reduce(map(items(parameters('values')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', ''))), createObject('key', '', 'value', '', 'result', ''), lambda('current', 'next', createObject('key', lambdaVariables('next').key, 'value', lambdaVariables('next').value, 'result', if(and(not(equals(lambdaVariables('next').key, 'UNIQUE')), greater(length(filter(parameters('placeholders'), lambda('item', equals(tryGet(lambdaVariables('item'), 'name'), lambdaVariables('next').key)))), 0)), if(equals(lambdaVariables('current').result, ''), lambdaVariables('next').value, format('{0},{1}', lambdaVariables('current').result, lambdaVariables('next').value)), lambdaVariables('current').result)))).result)]"
            }
          }
        },
        "getRangedInt": {
          "parameters": [
            {
              "type": "int",
              "nullable": true,
              "name": "value"
            },
            {
              "type": "int",
              "nullable": true,
              "name": "minValue"
            },
            {
              "type": "int",
              "name": "maxValue"
            }
          ],
          "output": {
            "type": "int",
            "value": "[sub(range(coalesce(parameters('minValue'), 1), parameters('maxValue'))[if(greaterOrEquals(sub(coalesce(parameters('value'), -1), coalesce(parameters('minValue'), 1)), 0), sub(coalesce(parameters('value'), -1), sub(coalesce(parameters('minValue'), 1), 1)), -1)], 1)]"
          }
        },
        "getInstanceString": {
          "parameters": [
            {
              "$ref": "#/definitions/instanceInfoType",
              "name": "instanceInfo"
            }
          ],
          "output": {
            "type": "string",
            "value": "[padLeft(namingConvention.getRangedInt(parameters('instanceInfo').value, parameters('instanceInfo').minValue, parameters('instanceInfo').maxValue), parameters('instanceInfo').padding.totalLength, parameters('instanceInfo').padding.character)]"
          }
        },
        "getUniqueString": {
          "parameters": [
            {
              "$ref": "#/definitions/uniqueInfoType",
              "name": "uniqueInfo"
            }
          ],
          "output": {
            "type": "string",
            "value": "[substring(uniqueString(coalesce(parameters('uniqueInfo').seed, '')), 0, coalesce(parameters('uniqueInfo').length, -1))]"
          }
        },
        "getFormatString": {
          "parameters": [
            {
              "type": "string",
              "name": "configKey"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "string",
            "value": "[if(and(contains(parameters('configKey'), '{'), contains(parameters('configKey'), '}')), parameters('configKey'), coalesce(namingConvention.resolveFormatValue(parameters('configKey'), 'formatString', parameters('config')), parameters('configKey')))]"
          }
        },
        "getSeparatorString": {
          "parameters": [
            {
              "type": "string",
              "name": "configKey"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "string",
            "nullable": true,
            "value": "[coalesce(namingConvention.resolveFormatValue(parameters('configKey'), 'separator', parameters('config')), '')]"
          }
        },
        "getCasing": {
          "parameters": [
            {
              "type": "string",
              "name": "configKey"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "string",
            "nullable": true,
            "value": "[namingConvention.resolveFormatValue(parameters('configKey'), 'casing', parameters('config'))]"
          }
        },
        "getMaxLength": {
          "parameters": [
            {
              "type": "string",
              "name": "configKey"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "int",
            "nullable": true,
            "value": "[json(format('{{\"value\":{0}}}', coalesce(namingConvention.resolveFormatValue(parameters('configKey'), 'maxLength', parameters('config')), 'null'))).value]"
          }
        },
        "applyCasing": {
          "parameters": [
            {
              "type": "string",
              "name": "value"
            },
            {
              "type": "string",
              "nullable": true,
              "name": "casing"
            }
          ],
          "output": {
            "type": "string",
            "value": "[if(equals(toLower(coalesce(parameters('casing'), '')), 'lower'), toLower(parameters('value')), if(equals(toLower(coalesce(parameters('casing'), '')), 'upper'), toUpper(parameters('value')), parameters('value')))]"
          }
        },
        "getPlaceholderInfo": {
          "parameters": [
            {
              "type": "string",
              "name": "formatString"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/placeholderInfoType"
            },
            "value": "[concat(filter(reduce(map(split(parameters('formatString'), '['), lambda('item1', if(contains(lambdaVariables('item1'), ']'), reduce(map(split(lambdaVariables('item1'), ']'), lambda('item2', 'index2', map(filter(split(lambdaVariables('item2'), '{'), lambda('item3', not(equals(coalesce(lambdaVariables('item3'), ''), '')))), lambda('item4', namingConvention.toPlaceholderInfo(coalesce(split(lambdaVariables('item4'), '}')[0], ''), equals(lambdaVariables('index2'), 0), parameters('config')))))), createArray(), lambda('current2', 'next2', concat(lambdaVariables('current2'), lambdaVariables('next2')))), map(filter(split(lambdaVariables('item1'), '{'), lambda('item5', not(equals(coalesce(lambdaVariables('item5'), ''), '')))), lambda('item6', namingConvention.toPlaceholderInfo(coalesce(split(lambdaVariables('item6'), '}')[0], ''), false(), parameters('config'))))))), createArray(), lambda('current1', 'next1', concat(lambdaVariables('current1'), lambdaVariables('next1')))), lambda('item', not(equals(lambdaVariables('item'), null())))), createArray(createObject('name', '-', 'optional', false(), 'type', 'constant'), createObject('name', 'SEPARATOR', 'optional', false(), 'type', 'constant')))]"
          }
        },
        "toPlaceholderInfo": {
          "parameters": [
            {
              "type": "string",
              "name": "name"
            },
            {
              "type": "bool",
              "name": "optional"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "$ref": "#/definitions/placeholderInfoType",
            "nullable": true,
            "value": "[if(not(contains(createArray('', '-', 'SEPARATOR'), trim(parameters('name')))), createObject('name', trim(parameters('name')), 'optional', parameters('optional'), 'type', tryGet(tryGet(tryGet(parameters('config'), 'placeholders'), parameters('name')), '$type')), null())]"
          }
        },
        "validate": {
          "parameters": [
            {
              "$ref": "#/definitions/formatNameInfoType",
              "name": "formatInfo"
            },
            {
              "type": "string",
              "nullable": true,
              "name": "result"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "throwError"
            }
          ],
          "output": {
            "type": "bool",
            "value": "[and(and(and(namingConvention.validatePlaceholders(parameters('formatInfo').placeholders, parameters('formatInfo').valueKeys, parameters('formatInfo').validValueKeys, parameters('throwError')), namingConvention.validateValues(parameters('formatInfo').placeholders, parameters('formatInfo').valueKeys, parameters('formatInfo').additionalValues, parameters('throwError'))), greater(length(parameters('formatInfo').validValueKeys), 0)), if(not(equals(parameters('result'), null())), namingConvention.validateLength(parameters('formatInfo'), coalesce(parameters('result'), ''), parameters('throwError')), true()))]"
          }
        },
        "validateValues": {
          "parameters": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/placeholderInfoType"
              },
              "name": "placeholders"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              },
              "name": "valueKeys"
            },
            {
              "type": "bool",
              "name": "additionalValues"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "throwError"
            }
          ],
          "output": {
            "type": "bool",
            "value": "[if(parameters('additionalValues'), true(), equals(map(createArray(reduce(map(parameters('valueKeys'), lambda('item1', createObject('item', lambdaVariables('item1'), 'isValid', greater(length(filter(parameters('placeholders'), lambda('item2', equals(tryGet(lambdaVariables('item2'), 'name'), lambdaVariables('item1'))))), 0), 'error', createArray()))), createObject('item', null(), 'isValid', null(), 'error', createArray()), lambda('current', 'next', createObject('error', concat(lambdaVariables('current').error, if(not(coalesce(lambdaVariables('next').isValid, true())), createArray(lambdaVariables('next').item), createArray())))))), lambda('item0', if(equals(length(lambdaVariables('item0').error), 0), null(), if(coalesce(parameters('throwError'), true()), reduce(map(parameters('placeholders'), lambda('item', createObject(format('{0}', coalesce(tryGet(lambdaVariables('item'), 'name'), '')), null()))), createObject(), lambda('current', 'next', union(lambdaVariables('current'), lambdaVariables('next'))))[format('placeholder: ''{0}''', join(lambdaVariables('item0').error, ', '))], lambdaVariables('item0').error))))[0], null()))]"
          }
        },
        "validatePlaceholders": {
          "parameters": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/placeholderInfoType"
              },
              "name": "placeholders"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              },
              "name": "valueKeys"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              },
              "name": "validValueKeys"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "throwError"
            }
          ],
          "output": {
            "type": "bool",
            "value": "[equals(map(createArray(reduce(map(parameters('placeholders'), lambda('item', createObject('item', lambdaVariables('item'), 'isValid', if(coalesce(tryGet(lambdaVariables('item'), 'optional'), true()), true(), contains(parameters('validValueKeys'), coalesce(tryGet(lambdaVariables('item'), 'name'), ''))), 'error', createArray()))), createObject('item', null(), 'isValid', null(), 'error', createArray()), lambda('current', 'next', createObject('error', concat(lambdaVariables('current').error, if(not(coalesce(lambdaVariables('next').isValid, true())), createArray(coalesce(tryGet(lambdaVariables('next').item, 'name'), '')), createArray())))))), lambda('item0', if(equals(length(lambdaVariables('item0').error), 0), null(), if(coalesce(parameters('throwError'), true()), reduce(map(parameters('valueKeys'), lambda('item1', createObject(format('{0}', lambdaVariables('item1')), null()))), createObject(), lambda('current', 'next', union(lambdaVariables('current'), lambdaVariables('next'))))[format('value: ''{0}''', join(lambdaVariables('item0').error, ', '))], lambdaVariables('item0').error))))[0], null())]"
          }
        },
        "validateLength": {
          "parameters": [
            {
              "$ref": "#/definitions/formatNameInfoType",
              "name": "formatInfo"
            },
            {
              "type": "string",
              "name": "result"
            },
            {
              "type": "bool",
              "nullable": true,
              "name": "throwError"
            }
          ],
          "output": {
            "type": "bool",
            "value": "[if(not(equals(parameters('result'), '')), if(not(equals(parameters('formatInfo').maxLength, null())), if(coalesce(parameters('throwError'), true()), greater(range(0, coalesce(parameters('formatInfo').maxLength, 0))[sub(length(parameters('result')), 1)], 0), lessOrEquals(length(parameters('result')), coalesce(parameters('formatInfo').maxLength, 0))), true()), not(equals(string(namingConvention.emptyArray()[0]), '')))]"
          }
        },
        "emptyArray": {
          "parameters": [],
          "output": {
            "type": "array",
            "value": []
          }
        },
        "getValidValueKeys": {
          "parameters": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/placeholderInfoType"
              },
              "name": "placeholders"
            },
            {
              "type": "object",
              "name": "values"
            }
          ],
          "output": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "value": "[union(filter(map(parameters('placeholders'), lambda('item', if(not(equals(trim(string(coalesce(tryGet(parameters('values'), coalesce(tryGet(lambdaVariables('item'), 'name'), '')), ''))), '')), coalesce(tryGet(lambdaVariables('item'), 'name'), ''), if(coalesce(tryGet(lambdaVariables('item'), 'optional'), false()), if(contains(parameters('values'), coalesce(tryGet(lambdaVariables('item'), 'name'), '')), coalesce(tryGet(lambdaVariables('item'), 'name'), ''), ''), '')))), lambda('item', not(equals(lambdaVariables('item'), '')))), createArray('-', 'SEPARATOR'))]"
          }
        },
        "resolveFormatValue": {
          "parameters": [
            {
              "type": "string",
              "name": "configKey"
            },
            {
              "type": "string",
              "name": "valueKey"
            },
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "string",
            "nullable": true,
            "value": "[map(createArray(namingConvention.resolveAny(createArray(createObject('key', '$value', 'object', if(contains(string(coalesce(tryGet(tryGet(tryGet(parameters('config'), 'format'), parameters('configKey')), parameters('valueKey')), createObject())), '\"$value\":'), tryGet(tryGet(tryGet(parameters('config'), 'format'), parameters('configKey')), parameters('valueKey')), createObject()))))), lambda('item', if(lambdaVariables('item').hasValue, lambdaVariables('item'), namingConvention.resolveAny(createArray(createObject('key', parameters('valueKey'), 'object', tryGet(tryGet(parameters('config'), 'format'), parameters('configKey'))), createObject('key', parameters('valueKey'), 'object', tryGet(tryGet(parameters('config'), 'format'), 'default')))))))[0].stringResult]"
          }
        },
        "resolveAny": {
          "parameters": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/resolveItemType"
              },
              "name": "items"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(parameters('items'), lambda('item', createObject('key', lambdaVariables('item').key, 'object', lambdaVariables('item').object, 'result', null(), 'stringResult', null(), 'hasValue', false()))), createObject('result', null(), 'stringResult', null(), 'hasValue', false()), lambda('current', 'next', createObject('result', if(not(lambdaVariables('current').hasValue), tryGet(lambdaVariables('next').object, lambdaVariables('next').key), lambdaVariables('current').result), 'stringResult', if(not(lambdaVariables('current').hasValue), if(not(equals(trim(string(coalesce(tryGet(lambdaVariables('next').object, lambdaVariables('next').key), ''))), '')), string(coalesce(tryGet(lambdaVariables('next').object, lambdaVariables('next').key), '')), lambdaVariables('current').stringResult), lambdaVariables('current').stringResult), 'hasValue', if(lambdaVariables('current').hasValue, true(), or(not(equals(tryGet(lambdaVariables('next').object, lambdaVariables('next').key), null())), and(contains(coalesce(lambdaVariables('next').object, createObject()), lambdaVariables('next').key), equals(lambdaVariables('next').key, '$value')))))))]"
          }
        },
        "resolveRef": {
          "parameters": [
            {
              "type": "object",
              "name": "ref"
            },
            {
              "type": "object",
              "name": "object"
            }
          ],
          "output": {
            "type": "object",
            "value": {
              "result": "[reduce(map(skip(split(parameters('ref').path, '/'), 1), lambda('item', createObject('key', lambdaVariables('item'), 'object', null()))), createObject('object', parameters('object')), lambda('current', 'next', createObject('object', tryGet(lambdaVariables('current').object, lambdaVariables('next').key)))).object]"
            }
          }
        },
        "resolveConfig": {
          "parameters": [
            {
              "type": "object",
              "name": "config"
            }
          ],
          "output": {
            "type": "object",
            "value": "[namingConvention.resolveRefObject0(parameters('config'), parameters('config'))]"
          }
        },
        "resolveRefObject0": {
          "parameters": [
            {
              "type": "object",
              "name": "root"
            },
            {
              "type": "object",
              "name": "object"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createObject()))), createObject('result', createObject()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(startsWith(lambdaVariables('next').key, '$ref:'), createObject(format('{0}', substring(lambdaVariables('next').key, 5)), namingConvention.resolveRef(lambdaVariables('next').value, parameters('root')).result), if(and(startsWith(string(coalesce(lambdaVariables('next').value, '')), '{'), endsWith(string(coalesce(lambdaVariables('next').value, '')), '}')), createObject(format('{0}', lambdaVariables('next').key), namingConvention.resolveRefObject1(parameters('root'), lambdaVariables('next').value)), createObject(format('{0}', lambdaVariables('next').key), lambdaVariables('next').value))))))).result]"
          }
        },
        "resolveRefObject1": {
          "parameters": [
            {
              "type": "object",
              "name": "root"
            },
            {
              "type": "object",
              "name": "object"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createObject()))), createObject('result', createObject()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(startsWith(lambdaVariables('next').key, '$ref:'), createObject(format('{0}', substring(lambdaVariables('next').key, 5)), namingConvention.resolveRef(lambdaVariables('next').value, parameters('root')).result), if(and(startsWith(string(coalesce(lambdaVariables('next').value, '')), '{'), endsWith(string(coalesce(lambdaVariables('next').value, '')), '}')), createObject(format('{0}', lambdaVariables('next').key), namingConvention.resolveRefObject2(parameters('root'), lambdaVariables('next').value)), createObject(format('{0}', lambdaVariables('next').key), lambdaVariables('next').value))))))).result]"
          }
        },
        "resolveRefObject2": {
          "parameters": [
            {
              "type": "object",
              "name": "root"
            },
            {
              "type": "object",
              "name": "object"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createObject()))), createObject('result', createObject()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(startsWith(lambdaVariables('next').key, '$ref:'), createObject(format('{0}', substring(lambdaVariables('next').key, 5)), namingConvention.resolveRef(lambdaVariables('next').value, parameters('root')).result), if(and(startsWith(string(coalesce(lambdaVariables('next').value, '')), '{'), endsWith(string(coalesce(lambdaVariables('next').value, '')), '}')), createObject(format('{0}', lambdaVariables('next').key), namingConvention.resolveRefObject3(parameters('root'), lambdaVariables('next').value)), createObject(format('{0}', lambdaVariables('next').key), lambdaVariables('next').value))))))).result]"
          }
        },
        "resolveRefObject3": {
          "parameters": [
            {
              "type": "object",
              "name": "root"
            },
            {
              "type": "object",
              "name": "object"
            }
          ],
          "output": {
            "type": "object",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createObject()))), createObject('result', createObject()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(startsWith(lambdaVariables('next').key, '$ref:'), createObject(format('{0}', substring(lambdaVariables('next').key, 5)), namingConvention.resolveRef(lambdaVariables('next').value, parameters('root')).result), createObject(format('{0}', lambdaVariables('next').key), lambdaVariables('next').value)))))).result]"
          }
        },
        "flattenObject": {
          "parameters": [
            {
              "type": "object",
              "name": "object"
            }
          ],
          "output": {
            "type": "array",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createArray()))), createObject('result', createArray()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(and(startsWith(string(coalesce(lambdaVariables('next').value, '')), '{'), endsWith(string(coalesce(lambdaVariables('next').value, '')), '}')), if(namingConvention.isEvaluateObject(lambdaVariables('next').value), createArray(union(createObject('path', format('#/{0}', lambdaVariables('next').key)), lambdaVariables('next').value)), namingConvention.flattenObject0(lambdaVariables('next').value, format('#/{0}', lambdaVariables('next').key))), createArray()))))).result]"
          }
        },
        "flattenObject0": {
          "parameters": [
            {
              "type": "object",
              "name": "object"
            },
            {
              "type": "string",
              "name": "path"
            }
          ],
          "output": {
            "type": "array",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createArray()))), createObject('result', createArray()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(and(startsWith(string(coalesce(lambdaVariables('next').value, '')), '{'), endsWith(string(coalesce(lambdaVariables('next').value, '')), '}')), if(namingConvention.isEvaluateObject(lambdaVariables('next').value), createArray(union(createObject('path', format('{0}/{1}', parameters('path'), lambdaVariables('next').key)), lambdaVariables('next').value)), namingConvention.flattenObject1(lambdaVariables('next').value, format('{0}/{1}', parameters('path'), lambdaVariables('next').key))), createArray()))))).result]"
          }
        },
        "flattenObject1": {
          "parameters": [
            {
              "type": "object",
              "name": "object"
            },
            {
              "type": "string",
              "name": "path"
            }
          ],
          "output": {
            "type": "array",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createArray()))), createObject('result', createArray()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(and(startsWith(string(coalesce(lambdaVariables('next').value, '')), '{'), endsWith(string(coalesce(lambdaVariables('next').value, '')), '}')), if(namingConvention.isEvaluateObject(lambdaVariables('next').value), createArray(union(createObject('path', format('{0}/{1}', parameters('path'), lambdaVariables('next').key)), lambdaVariables('next').value)), namingConvention.flattenObject2(lambdaVariables('next').value, format('{0}/{1}', parameters('path'), lambdaVariables('next').key))), createArray()))))).result]"
          }
        },
        "flattenObject2": {
          "parameters": [
            {
              "type": "object",
              "name": "object"
            },
            {
              "type": "string",
              "name": "path"
            }
          ],
          "output": {
            "type": "array",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createArray()))), createObject('result', createArray()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(and(startsWith(string(coalesce(lambdaVariables('next').value, '')), '{'), endsWith(string(coalesce(lambdaVariables('next').value, '')), '}')), if(namingConvention.isEvaluateObject(lambdaVariables('next').value), createArray(union(createObject('path', format('{0}/{1}', parameters('path'), lambdaVariables('next').key)), lambdaVariables('next').value)), namingConvention.flattenObject3(lambdaVariables('next').value, format('{0}/{1}', parameters('path'), lambdaVariables('next').key))), createArray()))))).result]"
          }
        },
        "flattenObject3": {
          "parameters": [
            {
              "type": "object",
              "name": "object"
            },
            {
              "type": "string",
              "name": "path"
            }
          ],
          "output": {
            "type": "array",
            "value": "[reduce(map(items(parameters('object')), lambda('item', createObject('key', lambdaVariables('item').key, 'value', lambdaVariables('item').value, 'result', createArray()))), createObject('result', createArray()), lambda('current', 'next', createObject('result', union(lambdaVariables('current').result, if(and(startsWith(string(coalesce(lambdaVariables('next').value, '')), '{'), endsWith(string(coalesce(lambdaVariables('next').value, '')), '}')), if(namingConvention.isEvaluateObject(lambdaVariables('next').value), createArray(union(createObject('path', format('{0}/{1}', parameters('path'), lambdaVariables('next').key)), lambdaVariables('next').value)), createArray()), createArray()))))).result]"
          }
        },
        "isEvaluateObject": {
          "parameters": [
            {
              "type": "object",
              "name": "object"
            }
          ],
          "output": {
            "type": "bool",
            "value": "[and(and(not(equals(tryGet(parameters('object'), 'formatInfo'), null())), not(equals(tryGet(parameters('object'), 'isValid'), null()))), not(equals(tryGet(parameters('object'), 'result'), null())))]"
          }
        }
      }
    }
  ],
  "resources": {
    "config": {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "name": "[concat('nc-config-', parameters('utcValue'))]",
      "properties": {
        "mode": "incremental",
        "templateLink": {
          "uri": "https://raw.githubusercontent.com/jimmieulenius/az-naming-convention/main/src/template/arm/config.json",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "formatTemplateUri": {
            "value": "[parameters('formatTemplateUri')]"
          },
          "placeholdersTemplateUri": {
            "value": "[parameters('placeholdersTemplateUri')]"
          },
          "userConfigTemplateUri": {
            "value": "[parameters('userConfigTemplateUri')]"
          },
          "userConfig": {
            "value": "[parameters('userConfig')]"
          }
        }
      }
    }
  },
  "parameters": {
    "formatString": {
      "type": "string",
      "nullable": true
    },
    "values": {
      "type": "object",
      "defaultValue": {}
    },
    "graph": {
      "type": "object"
    },
    "function": {
      "type": "string",
      "defaultValue": "formatName"
    },
    "additionalValues": {
      "type": "bool",
      "defaultValue": true
    },
    "userConfig": {
      "type": "object",
      "defaultValue": {}
    },
    "userConfigTemplateUri": {
      "type": "string",
      "defaultValue": ""
    },
    "formatTemplateUri": {
      "type": "string"
    },
    "placeholdersTemplateUri": {
      "type": "string"
    },
    "utcValue": {
      "type": "string",
      "defaultValue": "[utcNow()]"
    }
  },
  "outputs": {
    "nameGraph": {
      "type": "object",
      "value": "[namingConvention.nameGraph(parameters('formatString'), parameters('values'), parameters('graph'), parameters('function'), parameters('additionalValues'), namingConvention.resolveConfig(reference('config').outputs.config.value))]"
    }
  }
}
